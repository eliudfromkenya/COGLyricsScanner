<?xml version="1.0" encoding="utf-8" ?>
<ContentPage x:Class="COGLyricsScanner.Views.CollectionModalPage"
             xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             Title="{Binding Title}"
             BackgroundColor="{DynamicResource PageBackgroundColor}">
    
    <Grid>
        <ScrollView>
            <Grid Padding="20" RowDefinitions="Auto,*,Auto" RowSpacing="20">
            
            <!-- Header -->
            <StackLayout Grid.Row="0" Spacing="8">
                <Label Text="{Binding Title}" 
                       FontSize="24" 
                       FontAttributes="Bold"
                       TextColor="{DynamicResource PrimaryTextColor}"
                       HorizontalOptions="Center" />
                <Label Text="{Binding Subtitle}" 
                       FontSize="14" 
                       TextColor="{DynamicResource SecondaryTextColor}"
                       HorizontalOptions="Center"
                       IsVisible="{Binding Subtitle, Converter={StaticResource StringToBoolConverter}}" />
            </StackLayout>
            
            <!-- Form Content -->
            <StackLayout Grid.Row="1" Spacing="16">
                
                <!-- Collection Name -->
                <StackLayout Spacing="8">
                    <Label Text="Collection Name *" 
                           FontSize="16" 
                           FontAttributes="Bold"
                           TextColor="{DynamicResource PrimaryTextColor}" />
                    <Border BackgroundColor="{DynamicResource CardBackgroundColor}"
                            Stroke="{DynamicResource BorderColor}"
                            StrokeShape="RoundRectangle 8"
                            Padding="12">
                        <Entry x:Name="NameEntry"
                               Text="{Binding CollectionName}"
                               Placeholder="Enter collection name"
                               TextColor="{DynamicResource PrimaryTextColor}"
                               PlaceholderColor="{DynamicResource SecondaryTextColor}"
                               BackgroundColor="Transparent" />
                    </Border>
                    <Label Text="{Binding NameError}" 
                           FontSize="12" 
                           TextColor="{DynamicResource ErrorColor}"
                           IsVisible="{Binding NameError, Converter={StaticResource StringToBoolConverter}}" />
                </StackLayout>
                
                <!-- Collection Description -->
                <StackLayout Spacing="8">
                    <Label Text="Description" 
                           FontSize="16" 
                           FontAttributes="Bold"
                           TextColor="{DynamicResource PrimaryTextColor}" />
                    <Border BackgroundColor="{DynamicResource CardBackgroundColor}"
                            Stroke="{DynamicResource BorderColor}"
                            StrokeShape="RoundRectangle 8"
                            Padding="12">
                        <Editor x:Name="DescriptionEditor"
                                Text="{Binding CollectionDescription}"
                                Placeholder="Enter collection description (optional)"
                                TextColor="{DynamicResource PrimaryTextColor}"
                                PlaceholderColor="{DynamicResource SecondaryTextColor}"
                                BackgroundColor="Transparent"
                                HeightRequest="100" />
                    </Border>
                </StackLayout>
                
                <!-- Collection Stats (for edit mode) -->
                <StackLayout Spacing="8" IsVisible="{Binding IsEditMode}">
                    <Label Text="Collection Information" 
                           FontSize="16" 
                           FontAttributes="Bold"
                           TextColor="{DynamicResource PrimaryTextColor}" />
                    <Border BackgroundColor="{DynamicResource CardBackgroundColor}"
                            Stroke="{DynamicResource BorderColor}"
                            StrokeShape="RoundRectangle 8"
                            Padding="16">
                        <Grid RowDefinitions="Auto,Auto,Auto" RowSpacing="8">
                            <Label Grid.Row="0"
                                   FontSize="14"
                                   TextColor="{DynamicResource SecondaryTextColor}">
                                <Label.Text>
                                    <MultiBinding StringFormat="Hymns: {0}">
                                        <Binding Path="HymnCount" />
                                    </MultiBinding>
                                </Label.Text>
                            </Label>
                            <Label Grid.Row="1"
                                   Text="{Binding CreatedAt, StringFormat='Created: {0:MMM dd, yyyy}'}"
                                   FontSize="14"
                                   TextColor="{DynamicResource SecondaryTextColor}" />
                            <Label Grid.Row="2"
                                   Text="{Binding UpdatedAt, StringFormat='Updated: {0:MMM dd, yyyy}'}"
                                   FontSize="14"
                                   TextColor="{DynamicResource SecondaryTextColor}"
                                   IsVisible="{Binding UpdatedAt, Converter={StaticResource DateTimeToVisibilityConverter}}" />
                        </Grid>
                    </Border>
                </StackLayout>

                <!-- Loading Overlay -->
                <Grid IsVisible="{Binding IsLoading}"
                    BackgroundColor="#80000000">
                    <ActivityIndicator IsRunning="{Binding IsLoading}"
                        Color="{DynamicResource Primary}"
                        VerticalOptions="Center"
                        HorizontalOptions="Center" />
                </Grid>

            </StackLayout>
            
            <!-- Action Buttons -->
            <Grid Grid.Row="2" ColumnDefinitions="*,*" RowDefinitions="Auto,Auto" ColumnSpacing="12">
                
                <!-- Cancel Button -->
                <Button Grid.Column="0"
                        Text="Cancel"
                        FontSize="16"
                        BackgroundColor="{DynamicResource SecondaryButtonBackgroundColor}"
                        TextColor="{DynamicResource SecondaryButtonTextColor}"
                        CornerRadius="8"
                        HeightRequest="50"
                        Command="{Binding CancelCommand}" />
                
                <!-- Save Button -->
                <Button Grid.Column="1"
                        Text="{Binding SaveButtonText}"
                        FontSize="16"
                        Style="{DynamicResource BaseButtonStyle}"
                        CornerRadius="8"
                        HeightRequest="50"
                        Command="{Binding SaveCommand}"
                        IsEnabled="{Binding CanSave}" />

                <!-- Delete Button (for edit mode) -->
                <Button Grid.Row="1"
                       Text="Delete Collection"
                       FontSize="16"
                       BackgroundColor="{DynamicResource ErrorColor}"
                       TextColor="White"
                       CornerRadius="8"
                       HeightRequest="50"
                       Margin="0,12,0,0"
                       Command="{Binding DeleteCommand}"
                       IsVisible="{Binding IsEditMode}" />          

            </Grid>   
            </Grid>
        </ScrollView>
        
        <!-- Floating Home Button -->
        <Button Style="{StaticResource FloatingHomeButton}"
                Command="{Binding NavigateToCollectionsCommand}" />
    </Grid>
    
</ContentPage>